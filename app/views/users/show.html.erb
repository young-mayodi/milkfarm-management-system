<% content_for :title, "User Profile" %>

<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 mb-1">
        <i class="bi bi-person-circle me-2 text-primary"></i>
        <%= @user.full_name %>
      </h1>
      <p class="text-muted mb-0">User profile and access details</p>
    </div>
    <div class="d-flex gap-2">
      <%= link_to users_path, class: "btn btn-outline-secondary" do %>
        <i class="bi bi-arrow-left me-1"></i>Back to Users
      <% end %>
      <% if current_user.can_manage_farm? %>
        <%= link_to edit_user_path(@user), class: "btn btn-primary" do %>
          <i class="bi bi-pencil-square me-1"></i>Edit User
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
            <i class="bi bi-person-fill fs-1 text-primary"></i>
          </div>
          <h5 class="mb-1"><%= @user.full_name %></h5>
          <div class="text-muted mb-3"><%= @user.email %></div>
          <span class="badge bg-info text-dark"><%= @user.role.humanize %></span>
          <% if @user.active %>
            <span class="badge bg-success ms-1">Active</span>
          <% else %>
            <span class="badge bg-secondary ms-1">Inactive</span>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
          <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Details</h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <div class="text-muted small">First Name</div>
              <div class="fw-semibold"><%= @user.first_name %></div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Last Name</div>
              <div class="fw-semibold"><%= @user.last_name %></div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Email</div>
              <div class="fw-semibold"><%= @user.email %></div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Phone</div>
              <div class="fw-semibold"><%= @user.phone.presence || "Not provided" %></div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Role</div>
              <div class="fw-semibold"><%= @user.role.humanize %></div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Farm</div>
              <div class="fw-semibold"><%= @user.farm&.name || "N/A" %></div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Last Sign In</div>
              <div class="fw-semibold">
                <%= @user.last_sign_in_at ? @user.last_sign_in_at.strftime("%b %d, %Y %I:%M %p") : "Never" %>
              </div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Created</div>
              <div class="fw-semibold"><%= @user.created_at.strftime("%b %d, %Y") %></div>
            </div>
          </div>
        </div>
      </div>

      <% if current_user.can_manage_farm? && @user != current_user %>
        <div class="card border-0 shadow-sm mt-4">
          <div class="card-header bg-white">
            <h6 class="mb-0"><i class="bi bi-shield-lock me-2"></i>Admin Actions</h6>
          </div>
          <div class="card-body">
            <% if @user.active %>
              <%= button_to "Deactivate User", user_path(@user), method: :delete, class: "btn btn-outline-danger", data: { confirm: "Deactivate this user? They will no longer be able to sign in." } %>
            <% else %>
              <span class="text-muted">User is inactive.</span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
