<% content_for :title, "Milk Production Entry" %>

<!-- Modern Redesigned Bulk Entry Interface -->
<div class="production-entry-container" data-controller="form-validation loading">
  
  <!-- Top Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom mb-4 sticky-top shadow-sm">
    <div class="container-fluid">
      <div class="navbar-brand">
        <i class="bi bi-droplet-fill text-primary me-2"></i>
        <strong>Milk Production Entry</strong>
        <% if @readonly_mode %>
          <span class="badge bg-warning text-dark ms-2">
            <i class="bi bi-lock-fill me-1"></i>Read-Only
          </span>
        <% end %>
      </div>
      <div class="d-flex gap-2">
        <%= link_to production_records_path, class: "btn btn-sm btn-outline-secondary" do %>
          <i class="bi bi-arrow-left me-1"></i>Back to Records
        <% end %>
        <%= link_to new_production_record_path, class: "btn btn-sm btn-outline-primary" do %>
          <i class="bi bi-plus-circle me-1"></i>Single Entry
        <% end %>
      </div>
    </div>
  </nav>

  <!-- Read-Only Warning (if applicable) -->
  <% if @days_back && @days_back > 3 && @readonly_mode %>
    <div class="container-fluid mb-4">
      <div class="alert alert-warning d-flex align-items-center shadow-sm" role="alert">
        <i class="bi bi-shield-lock-fill me-3 fs-4"></i>
        <div>
          <strong>Historical Data Protection</strong>
          <p class="mb-0 small">Records older than 3 days are read-only for regular users. Contact your farm manager or owner to modify historical data.</p>
        </div>
      </div>
    </div>
  <% end %>

  <div class="container-fluid">
    <!-- Date & Farm Selection Card -->
    <div class="card mb-4 shadow-sm border-0">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
          <i class="bi bi-sliders me-2"></i>Selection
        </h5>
      </div>
      <div class="card-body">
        <%= form_with url: bulk_entry_production_records_path, method: :get, local: true, 
                      data: { controller: "loading", action: "submit->loading#show" } do |form| %>
          <div class="row g-3">
            <!-- Date Selection -->
            <div class="col-md-5">
              <label class="form-label fw-semibold">
                <i class="bi bi-calendar3 text-primary me-1"></i>Production Date
              </label>
              <%= form.date_field :date, 
                                 value: @date, 
                                 max: Date.current, 
                                 min: Date.current - 30.days,
                                 class: "form-control form-control-lg", 
                                 required: true %>
              <div class="form-text">
                <% if @days_back && @days_back > 0 %>
                  <i class="bi bi-info-circle me-1"></i>
                  <%= @days_back %> days ago
                  <% if @days_back > 3 %>
                    <span class="text-warning">‚Ä¢ Manager permission required</span>
                  <% end %>
                <% else %>
                  <i class="bi bi-check-circle text-success me-1"></i>Today's production
                <% end %>
              </div>
            </div>

            <!-- Farm Selection -->
            <div class="col-md-5">
              <label class="form-label fw-semibold">
                <i class="bi bi-building text-primary me-1"></i>Farm
              </label>
              <%= form.collection_select :farm_id, 
                      current_user.accessible_farms, :id, :name, 
                      { selected: @farm&.id }, 
                      { class: "form-select form-select-lg", required: true } %>
              <div class="form-text">
                <% if @farm %>
                  <i class="bi bi-check-circle text-success me-1"></i>
                  <%= @cows.count %> active animals available
                <% else %>
                  <i class="bi bi-info-circle me-1"></i>Select farm to load data
                <% end %>
              </div>
            </div>

            <!-- Load Button -->
            <div class="col-md-2 d-flex align-items-end">
              <%= form.submit "Load Data", 
                             class: "btn btn-primary btn-lg w-100",
                             data: { loading_target: "trigger" } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <% if @cows && @cows.any? %>
      <!-- Statistics Dashboard -->
      <div class="row g-3 mb-4">
        <div class="col-md-3 col-6">
          <div class="card border-0 shadow-sm h-100 bg-primary text-white">
            <div class="card-body text-center">
              <i class="bi bi-heart-fill fs-1 mb-2"></i>
              <h3 class="mb-0" id="total_animals"><%= @cows.count %></h3>
              <p class="mb-0 small">Total Animals</p>
            </div>
          </div>
        </div>
        <div class="col-md-3 col-6">
          <div class="card border-0 shadow-sm h-100 bg-success text-white">
            <div class="card-body text-center">
              <i class="bi bi-check-circle-fill fs-1 mb-2"></i>
              <h3 class="mb-0" id="recorded_animals">0</h3>
              <p class="mb-0 small">Recorded (<span id="completion_percentage">0</span>%)</p>
            </div>
          </div>
        </div>
        <div class="col-md-3 col-6">
          <div class="card border-0 shadow-sm h-100 bg-info text-white">
            <div class="card-body text-center">
              <i class="bi bi-droplet-fill fs-1 mb-2"></i>
              <h3 class="mb-0" id="total_production">0.0</h3>
              <p class="mb-0 small">Total Liters</p>
            </div>
          </div>
        </div>
        <div class="col-md-3 col-6">
          <div class="card border-0 shadow-sm h-100 bg-warning text-dark">
            <div class="card-body text-center">
              <i class="bi bi-graph-up fs-1 mb-2"></i>
              <h3 class="mb-0" id="average_production">0.0</h3>
              <p class="mb-0 small">Average/Animal</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Form -->
      <%= form_with url: bulk_update_production_records_path, method: :post, 
                    data: { 
                      controller: "form-validation loading",
                      action: "submit->loading#show submit->form-validation#validate"
                    } do |form| %>
        
        <%= hidden_field_tag :date, @date %>
        <%= hidden_field_tag :farm_id, @farm&.id %>

        <!-- Quick Fill Tools -->
        <div class="card mb-4 shadow-sm border-0">
          <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="bi bi-magic me-2 text-primary"></i>Quick Fill Tools
              </h5>
              <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#quickFillTools">
                <i class="bi bi-chevron-down"></i> Toggle
              </button>
            </div>
          </div>
          <div class="collapse show" id="quickFillTools">
            <div class="card-body">
              <!-- Tab Navigation -->
              <ul class="nav nav-pills mb-3" id="quickFillTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="fill-empty-tab" data-bs-toggle="pill" data-bs-target="#fill-empty" type="button">
                    <i class="bi bi-arrow-down-circle me-1"></i>Fill Empty
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="batch-actions-tab" data-bs-toggle="pill" data-bs-target="#batch-actions" type="button">
                    <i class="bi bi-lightning-fill me-1"></i>Batch Actions
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="smart-suggest-tab" data-bs-toggle="pill" data-bs-target="#smart-suggest" type="button">
                    <i class="bi bi-lightbulb-fill me-1"></i>Smart Suggest
                  </button>
                </li>
              </ul>

              <!-- Tab Content -->
              <div class="tab-content" id="quickFillTabContent">
                <!-- Fill Empty Sessions -->
                <div class="tab-pane fade show active" id="fill-empty">
                  <div class="row g-3">
                    <div class="col-md-2 col-6">
                      <label class="form-label small">Morning (L)</label>
                      <input type="number" class="form-control" id="bulk_morning" 
                             placeholder="0.0" step="0.1" min="0" max="50"
                             <%= 'disabled' if @readonly_mode %>>
                    </div>
                    <div class="col-md-2 col-6">
                      <label class="form-label small">Noon (L)</label>
                      <input type="number" class="form-control" id="bulk_noon" 
                             placeholder="0.0" step="0.1" min="0" max="50"
                             <%= 'disabled' if @readonly_mode %>>
                    </div>
                    <div class="col-md-2 col-6">
                      <label class="form-label small">Evening (L)</label>
                      <input type="number" class="form-control" id="bulk_evening" 
                             placeholder="0.0" step="0.1" min="0" max="50"
                             <%= 'disabled' if @readonly_mode %>>
                    </div>
                    <div class="col-md-2 col-6">
                      <label class="form-label small">Night (L)</label>
                      <input type="number" class="form-control" id="bulk_night" 
                             placeholder="0.0" step="0.1" min="0" max="50"
                             <%= 'disabled' if @readonly_mode %>>
                    </div>
                    <div class="col-md-4 col-12 d-flex align-items-end">
                      <button type="button" class="btn btn-primary w-100" id="apply_smart_fill"
                              <%= 'disabled' if @readonly_mode %>>
                        <i class="bi bi-check-circle me-1"></i>Apply to Empty Cells
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Batch Actions -->
                <div class="tab-pane fade" id="batch-actions">
                  <div class="d-flex flex-wrap gap-2">
                    <button type="button" class="btn btn-outline-info" id="copy_previous_day"
                            <%= 'disabled' if @readonly_mode %>>
                      <i class="bi bi-files me-1"></i>Copy Previous Day
                    </button>
                    <button type="button" class="btn btn-outline-success" id="apply_farm_average"
                            <%= 'disabled' if @readonly_mode %>>
                      <i class="bi bi-bar-chart me-1"></i>Apply Farm Average
                    </button>
                    <button type="button" class="btn btn-outline-warning" id="clear_all_data"
                            <%= 'disabled' if @readonly_mode %>>
                      <i class="bi bi-eraser me-1"></i>Clear All
                    </button>
                    <button type="button" class="btn btn-outline-secondary" id="reset_form">
                      <i class="bi bi-arrow-clockwise me-1"></i>Reset Form
                    </button>
                  </div>
                </div>

                <!-- Smart Suggestions -->
                <div class="tab-pane fade" id="smart-suggest">
                  <div class="alert alert-info mb-3">
                    <i class="bi bi-info-circle me-2"></i>
                    <small>Smart suggestions use historical data and patterns to pre-fill production values.</small>
                  </div>
                  <div class="d-flex flex-wrap gap-2">
                    <button type="button" class="btn btn-outline-primary" id="suggest_cow_history"
                            <%= 'disabled' if @readonly_mode %>>
                      <i class="bi bi-clock-history me-1"></i>Use Cow History
                    </button>
                    <button type="button" class="btn btn-outline-success" id="suggest_seasonal"
                            <%= 'disabled' if @readonly_mode %>>
                      <i class="bi bi-calendar2-week me-1"></i>Seasonal Pattern
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Keyboard Shortcuts Help -->
        <div class="alert alert-light border d-flex justify-content-between align-items-center mb-4 flex-wrap">
          <div class="mb-2 mb-md-0">
            <strong><i class="bi bi-keyboard me-2"></i>Shortcuts:</strong>
            <span class="ms-2"><kbd>Tab</kbd> Next</span>
            <span class="ms-2"><kbd>Enter</kbd> Down</span>
            <span class="ms-2"><kbd>Ctrl+S</kbd> Save</span>
            <span class="ms-2"><kbd>Esc</kbd> Clear</span>
          </div>
          <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#helpModal">
            <i class="bi bi-question-circle me-1"></i>Help
          </button>
        </div>

        <!-- Production Data Table -->
        <div class="card shadow border-0">
          <div class="card-header bg-white border-bottom">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
              <h5 class="mb-0">
                <i class="bi bi-table me-2 text-primary"></i>Production Data
                <span class="badge bg-secondary ms-2"><%= @cows.count %> animals</span>
              </h5>
              <% unless @readonly_mode %>
                <%= button_tag type: :submit, class: "btn btn-success", 
                              data: { loading_target: "trigger" } do %>
                  <i class="bi bi-save me-2"></i>Save All Records
                <% end %>
              <% end %>
            </div>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive" style="max-height: 60vh; overflow-y: auto;">
              <table class="table table-hover table-sm mb-0" id="production_table">
                <thead class="table-light sticky-top">
                  <tr>
                    <th style="width: 50px;" class="text-center">#</th>
                    <th style="width: 200px; position: sticky; left: 0; z-index: 10; background: #f8f9fa;">
                      <i class="bi bi-tag-fill me-1 text-primary"></i>Animal
                    </th>
                    <th class="text-center" style="width: 130px;">
                      <i class="bi bi-sunrise-fill me-1 text-warning"></i>Morning
                      <div class="small text-muted">6-10 AM</div>
                    </th>
                    <th class="text-center" style="width: 130px;">
                      <i class="bi bi-sun-fill me-1 text-info"></i>Noon
                      <div class="small text-muted">11-3 PM</div>
                    </th>
                    <th class="text-center" style="width: 130px;">
                      <i class="bi bi-sunset-fill me-1" style="color: #FF6B6B;"></i>Evening
                      <div class="small text-muted">4-8 PM</div>
                    </th>
                    <th class="text-center" style="width: 130px;">
                      <i class="bi bi-moon-fill me-1 text-dark"></i>Night
                      <div class="small text-muted">9 PM-5 AM</div>
                    </th>
                    <th class="text-center bg-light" style="width: 100px;">
                      <i class="bi bi-calculator-fill me-1 text-success"></i>Total
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <% @records.each_with_index do |record, index| %>
                    <% existing = @existing_records[record.cow.id] %>
                    <% has_data = existing&.total_production&.positive? %>
                    <tr data-cow-id="<%= record.cow.id %>" 
                        data-row-index="<%= index %>"
                        class="production-row <%= 'table-success' if has_data %>">
                      
                      <!-- Row Number -->
                      <td class="text-center align-middle">
                        <span class="badge <%= has_data ? 'bg-success' : 'bg-secondary' %>">
                          <%= index + 1 %>
                        </span>
                      </td>
                      
                      <!-- Animal Details -->
                      <td style="position: sticky; left: 0; z-index: 5; background: <%= has_data ? '#d1e7dd' : 'white' %>;" class="animal-cell">
                        <div class="d-flex align-items-center">
                          <div class="me-2">
                            <% if record.cow.status == 'graduated_to_dairy' %>
                              <span class="badge bg-success">üêÆ</span>
                            <% else %>
                              <span class="badge bg-primary">üêÑ</span>
                            <% end %>
                          </div>
                          <div class="flex-grow-1">
                            <div class="fw-bold text-truncate" style="max-width: 120px;" title="<%= record.cow.name %>"><%= record.cow.name %></div>
                            <small class="text-muted d-block">
                              <span class="badge bg-light text-dark"><%= record.cow.tag_number %></span>
                              <%= record.cow.breed %>
                              <% if record.cow.status == 'graduated_to_dairy' %>
                                ‚Ä¢ <span class="text-success">Grad</span>
                              <% end %>
                            </small>
                          </div>
                        </div>
                      </td>
                      
                      <% 
                        sessions = [
                          { field: :morning_production, class: 'morning', color: 'warning' },
                          { field: :noon_production, class: 'noon', color: 'info' },
                          { field: :evening_production, class: 'evening', color: 'danger' },
                          { field: :night_production, class: 'night', color: 'dark' }
                        ]
                      %>
                      
                      <!-- Production Inputs -->
                      <% sessions.each do |session| %>
                        <td class="text-center production-cell">
                          <%= number_field_tag "records[#{record.cow.id}][#{session[:field]}]",
                                               existing&.send(session[:field]),
                                               class: "form-control form-control-sm text-center production-input #{session[:class]}-input",
                                               step: 0.1, min: 0, max: 50,
                                               placeholder: "0.0",
                                               readonly: @readonly_mode,
                                               data: {
                                                 session: session[:class],
                                                 cow_id: record.cow.id,
                                                 row_index: index,
                                                 action: "input->form-validation#validateInput"
                                               } %>
                        </td>
                      <% end %>
                      
                      <!-- Total Column -->
                      <td class="text-center align-middle bg-light">
                        <strong class="text-success total-display" data-cow-id="<%= record.cow.id %>">
                          <%= existing&.total_production&.round(1) || '0.0' %>
                        </strong>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Footer with Save Button -->
          <% unless @readonly_mode %>
            <div class="card-footer bg-white border-top">
              <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <div class="text-muted small">
                  <i class="bi bi-info-circle me-1"></i>
                  All changes are saved when you click "Save All Records"
                </div>
                <%= button_tag type: :submit, class: "btn btn-success btn-lg px-4",
                              data: { loading_target: "trigger" } do %>
                  <i class="bi bi-cloud-upload me-2"></i>Save All Records
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <!-- No Data State -->
      <div class="text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted mb-3 d-block"></i>
        <h4 class="text-muted">No Animals Available</h4>
        <p class="text-muted">Please select a date and farm above to load production data.</p>
      </div>
    <% end %>
  </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-question-circle-fill me-2"></i>Production Entry Help
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h6 class="border-bottom pb-2 mb-3">Keyboard Shortcuts</h6>
        <table class="table table-sm">
          <tbody>
            <tr>
              <td><kbd>Tab</kbd></td>
              <td>Move to next input field</td>
            </tr>
            <tr>
              <td><kbd>Shift + Tab</kbd></td>
              <td>Move to previous input field</td>
            </tr>
            <tr>
              <td><kbd>Enter</kbd></td>
              <td>Move down to same session in next row</td>
            </tr>
            <tr>
              <td><kbd>Ctrl + S</kbd> or <kbd>Cmd + S</kbd></td>
              <td>Save all records</td>
            </tr>
            <tr>
              <td><kbd>Esc</kbd></td>
              <td>Clear current input field</td>
            </tr>
          </tbody>
        </table>

        <h6 class="border-bottom pb-2 mb-3 mt-4">Quick Fill Tools</h6>
        <dl class="row">
          <dt class="col-sm-4">Fill Empty</dt>
          <dd class="col-sm-8">Enter values and click "Apply to Empty Cells" to fill all empty fields for that session.</dd>
          
          <dt class="col-sm-4">Copy Previous Day</dt>
          <dd class="col-sm-8">Automatically copy production values from the previous day for all animals.</dd>
          
          <dt class="col-sm-4">Apply Farm Average</dt>
          <dd class="col-sm-8">Fill empty cells with your farm's average production per session.</dd>
          
          <dt class="col-sm-4">Smart Suggestions</dt>
          <dd class="col-sm-8">Use historical data and seasonal patterns to suggest production values.</dd>
        </dl>

        <h6 class="border-bottom pb-2 mb-3 mt-4">Tips & Features</h6>
        <ul>
          <li><strong>Visual Feedback:</strong> Green row background = Animal has recorded production</li>
          <li><strong>Units:</strong> All values are in liters (L) with 0.1 L precision</li>
          <li><strong>Validation:</strong> Maximum allowed per session: 50 L</li>
          <li><strong>Auto-Calculate:</strong> Total is automatically calculated from all sessions</li>
          <li><strong>Real-Time Stats:</strong> Dashboard updates as you enter data</li>
          <li><strong>Permissions:</strong> Records older than 3 days require manager permissions</li>
          <li><strong>Color Coding:</strong> Each milking session has a unique color for easy identification</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Custom JavaScript for Bulk Entry -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Real-time statistics update
  function updateStatistics() {
    const inputs = document.querySelectorAll('.production-input');
    let totalProduction = 0;
    let recordedAnimals = 0;
    const totalAnimals = parseInt(document.getElementById('total_animals')?.textContent || 0);
    
    // Calculate per-cow totals
    const cowTotals = {};
    inputs.forEach(input => {
      if (input.value && parseFloat(input.value) > 0) {
        const cowId = input.dataset.cowId;
        if (!cowTotals[cowId]) {
          cowTotals[cowId] = 0;
        }
        cowTotals[cowId] += parseFloat(input.value);
        totalProduction += parseFloat(input.value);
      }
    });
    
    // Update row totals and count recorded animals
    Object.entries(cowTotals).forEach(([cowId, total]) => {
      const totalDisplay = document.querySelector(`.total-display[data-cow-id="${cowId}"]`);
      if (totalDisplay) {
        totalDisplay.textContent = total.toFixed(1);
      }
      if (total > 0) recordedAnimals++;
    });
    
    // Update statistics cards
    const recordedElem = document.getElementById('recorded_animals');
    const completionElem = document.getElementById('completion_percentage');
    const totalProdElem = document.getElementById('total_production');
    const avgProdElem = document.getElementById('average_production');
    
    if (recordedElem) recordedElem.textContent = recordedAnimals;
    if (completionElem) completionElem.textContent = totalAnimals > 0 ? Math.round((recordedAnimals / totalAnimals) * 100) : 0;
    if (totalProdElem) totalProdElem.textContent = totalProduction.toFixed(1);
    if (avgProdElem) avgProdElem.textContent = recordedAnimals > 0 ? (totalProduction / recordedAnimals).toFixed(1) : '0.0';
  }
  
  // Attach event listeners to all production inputs
  const inputs = document.querySelectorAll('.production-input');
  inputs.forEach(input => {
    input.addEventListener('input', updateStatistics);
    
    // Enter key moves down in same column
    input.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const currentRow = parseInt(this.dataset.rowIndex);
        const session = this.dataset.session;
        const nextRow = currentRow + 1;
        const nextInput = document.querySelector(
          `.production-input[data-row-index="${nextRow}"][data-session="${session}"]`
        );
        if (nextInput) nextInput.focus();
      } else if (e.key === 'Escape') {
        this.value = '';
        updateStatistics();
      }
    });
  });
  
  // Quick Fill - Apply to Empty Cells
  const applyFillBtn = document.getElementById('apply_smart_fill');
  if (applyFillBtn) {
    applyFillBtn.addEventListener('click', function() {
      const sessions = ['morning', 'noon', 'evening', 'night'];
      sessions.forEach(session => {
        const bulkValue = document.getElementById(`bulk_${session}`)?.value;
        if (bulkValue && parseFloat(bulkValue) > 0) {
          document.querySelectorAll(`.${session}-input`).forEach(input => {
            if (!input.value || parseFloat(input.value) === 0) {
              input.value = bulkValue;
            }
          });
        }
      });
      updateStatistics();
    });
  }
  
  // Clear All Data
  const clearBtn = document.getElementById('clear_all_data');
  if (clearBtn) {
    clearBtn.addEventListener('click', function() {
      if (confirm('Are you sure you want to clear all entered data?')) {
        inputs.forEach(input => input.value = '');
        updateStatistics();
      }
    });
  }
  
  // Reset Form
  const resetBtn = document.getElementById('reset_form');
  if (resetBtn) {
    resetBtn.addEventListener('click', function() {
      if (confirm('Reset form to original values?')) {
        location.reload();
      }
    });
  }
  
  // Ctrl+S / Cmd+S to save
  document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
      e.preventDefault();
      const submitBtn = document.querySelector('button[type="submit"]');
      if (submitBtn && !submitBtn.disabled) {
        submitBtn.click();
      }
    }
  });
  
  // Initialize statistics on page load
  updateStatistics();
});
</script>

<!-- Custom Styles -->
<style>
.production-entry-container {
  min-height: 100vh;
  background: #f8f9fa;
}

.production-input {
  font-weight: 600;
  transition: all 0.2s;
  border: 2px solid #dee2e6;
}

.production-input:focus {
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
  transform: scale(1.05);
  border-color: #0d6efd;
}

.production-input:not(:placeholder-shown) {
  font-weight: 700;
}

.morning-input:not(:placeholder-shown) { 
  background-color: #fff3cd; 
  border-color: #ffc107;
  color: #997404;
}

.noon-input:not(:placeholder-shown) { 
  background-color: #cff4fc; 
  border-color: #0dcaf0;
  color: #055160;
}

.evening-input:not(:placeholder-shown) { 
  background-color: #f8d7da; 
  border-color: #dc3545;
  color: #842029;
}

.night-input:not(:placeholder-shown) { 
  background-color: #e2e3e5; 
  border-color: #6c757d;
  color: #2b2f32;
}

.production-row:hover {
  background-color: rgba(13, 110, 253, 0.05) !important;
}

.table-success {
  background-color: rgba(25, 135, 84, 0.1) !important;
}

.sticky-top {
  z-index: 1020;
}

.animal-cell {
  font-size: 0.9rem;
}

.total-display {
  font-size: 1.1rem;
}

kbd {
  padding: 0.2rem 0.4rem;
  font-size: 0.875rem;
  color: #fff;
  background-color: #212529;
  border-radius: 0.2rem;
}

.nav-pills .nav-link {
  color: #495057;
}

.nav-pills .nav-link.active {
  background-color: #0d6efd;
}

.card {
  transition: box-shadow 0.3s;
}

.card:hover {
  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

@media print {
  .navbar, .card-header, .card-footer, .quick-fill-tools, .alert, .btn {
    display: none !important;
  }
  
  .card {
    border: none !important;
    box-shadow: none !important;
  }
}

@media (max-width: 768px) {
  .table-responsive {
    font-size: 0.85rem;
  }
  
  .production-input {
    font-size: 0.9rem;
    padding: 0.25rem;
  }
  
  .animal-cell {
    font-size: 0.8rem;
  }
  
  .navbar-brand strong {
    font-size: 0.9rem;
  }
  
  th, td {
    padding: 0.5rem !important;
  }
  
  .card-body {
    padding: 0.75rem !important;
  }
}

@media (max-width: 576px) {
  .production-input {
    min-width: 70px;
  }
  
  th[style*="width: 130px"] {
    width: 90px !important;
  }
  
  .animal-cell > div {
    flex-direction: column;
    align-items: flex-start !important;
  }
}
</style>
