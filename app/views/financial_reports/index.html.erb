<% content_for :title, "Financial Reports" %>

<style>
  * {
    box-sizing: border-box;
  }

  body {
    overflow-x: hidden;
  }

  .container-fluid, .container {
    width: 100%;
    overflow-x: hidden;
  }

  .financial-header {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border-radius: 12px;
    padding: 30px;
    border-left: 5px solid #667eea;
    animation: slideInDown 0.6s ease-out;
    width: 100%;
    margin-bottom: 30px;
  }

  @keyframes slideInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .financial-title {
    font-size: 2rem;
    font-weight: 700;
    color: #1a202c;
    margin-bottom: 5px;
  }

  .financial-subtitle {
    font-size: 0.95rem;
    color: #718096;
    margin: 0;
  }

  .header-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .period-btn {
    padding: 8px 16px;
    border: 2px solid #667eea;
    background: white;
    color: #667eea;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
  }

  .period-btn:hover {
    background: #667eea;
    color: white;
  }

  .period-btn.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: transparent;
  }

  /* Stats Container */
  .stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
    margin-bottom: 30px;
    animation: fadeIn 0.6s ease-out both;
  }

  .stat-card {
    border-radius: 12px;
    padding: 20px;
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    animation: fadeIn 0.5s ease-out both;
    color: white;
  }

  .stat-card:nth-child(1) { animation-delay: 0.1s; }
  .stat-card:nth-child(2) { animation-delay: 0.2s; }
  .stat-card:nth-child(3) { animation-delay: 0.3s; }
  .stat-card:nth-child(4) { animation-delay: 0.4s; }

  .stat-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  }

  .stat-card.revenue { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
  .stat-card.expenses { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
  .stat-card.profit { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
  .stat-card.production { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }

  .stat-card-icon {
    font-size: 2rem;
    margin-bottom: 10px;
    opacity: 0.8;
  }

  .stat-card-value {
    font-size: 1.8rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 5px;
  }

  .stat-card-label {
    font-size: 0.85rem;
    opacity: 0.9;
    font-weight: 500;
    margin-bottom: 8px;
  }

  .stat-card-change {
    font-size: 0.75rem;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    opacity: 0.8;
  }

  /* Period Selector */
  .period-selector {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.05);
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  /* Charts Container */
  .charts-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
    margin-bottom: 30px;
  }

  .chart-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.05);
    animation: fadeIn 0.6s ease-out;
  }

  .chart-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1a202c;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .chart-title i {
    color: #667eea;
  }

  /* Quick Actions */
  .actions-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 30px;
  }

  .action-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    text-decoration: none;
    color: inherit;
  }

  .action-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    text-decoration: none;
    color: inherit;
  }

  .action-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
    display: block;
  }

  .action-card.success .action-icon { color: #10b981; }
  .action-card.warning .action-icon { color: #f59e0b; }
  .action-card.info .action-icon { color: #06b6d4; }
  .action-card.primary .action-icon { color: #667eea; }

  .action-title {
    font-weight: 600;
    color: #1a202c;
    font-size: 0.95rem;
    margin-bottom: 10px;
  }

  .action-description {
    font-size: 0.8rem;
    color: #718096;
  }

  /* KPI Section */
  .kpi-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 30px;
  }

  .kpi-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  .kpi-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1a202c;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .kpi-title i {
    color: #667eea;
  }

  .progress-item {
    margin-bottom: 20px;
  }

  .progress-item:last-child {
    margin-bottom: 0;
  }

  .progress-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-weight: 500;
    color: #2d3748;
  }

  .progress {
    height: 8px;
    background: #e2e8f0;
    border-radius: 10px;
    overflow: hidden;
  }

  .progress-bar {
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    height: 100%;
    transition: width 0.3s ease;
  }

  .progress-item.success .progress-bar {
    background: linear-gradient(90deg, #10b981 0%, #059669 100%);
  }

  .progress-item.warning .progress-bar {
    background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
  }

  .progress-item.danger .progress-bar {
    background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .financial-header {
      padding: 20px;
      margin-bottom: 20px;
    }

    .financial-title {
      font-size: 1.5rem;
    }

    .charts-container {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .stats-container {
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 20px;
    }

    .stat-card {
      padding: 15px;
    }

    .stat-card-value {
      font-size: 1.3rem;
    }

    .kpi-container {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .actions-container {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
  }

  @media (max-width: 576px) {
    .financial-header {
      padding: 15px;
      margin-bottom: 15px;
    }

    .financial-title {
      font-size: 1.3rem;
    }

    .header-actions {
      width: 100%;
      justify-content: start;
    }

    .period-btn {
      padding: 6px 10px;
      font-size: 0.8rem;
    }

    .stats-container {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
      margin-bottom: 15px;
    }

    .stat-card {
      padding: 12px;
    }

    .stat-card-icon {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }

    .stat-card-value {
      font-size: 1.1rem;
    }

    .stat-card-label {
      font-size: 0.7rem;
    }

    .period-selector {
      padding: 15px;
      gap: 8px;
    }

    .chart-card {
      padding: 15px;
    }

    .actions-container {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }

    .action-icon {
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    .kpi-card {
      padding: 15px;
    }
  }
</style>

<!-- Financial Header -->
<div class="financial-header">
  <div class="row align-items-center">
    <div class="col-lg-8">
      <div class="d-flex align-items-center gap-3">
        <div style="font-size: 2.5rem;">ðŸ’°</div>
        <div>
          <h1 class="financial-title mb-0">Financial Dashboard</h1>
          <p class="financial-subtitle">
            <i class="bi bi-graph-up me-2"></i>Comprehensive financial analysis and insights
          </p>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="header-actions justify-content-lg-end">
        <a href="<%= financial_reports_path(period: 'week') %>" class="period-btn <%= 'active' if params[:period] == 'week' %>">Week</a>
        <a href="<%= financial_reports_path(period: 'month') %>" class="period-btn <%= 'active' if params[:period] == 'month' || params[:period].blank? %>">Month</a>
        <a href="<%= financial_reports_path(period: 'quarter') %>" class="period-btn <%= 'active' if params[:period] == 'quarter' %>">Quarter</a>
        <a href="<%= financial_reports_path(period: 'year') %>" class="period-btn <%= 'active' if params[:period] == 'year' %>">Year</a>
      </div>
    </div>
  </div>
</div>

<!-- Financial Overview Stats -->
<div class="stats-container">
  <div class="stat-card revenue">
    <div class="stat-card-icon"><i class="bi bi-cash-coin"></i></div>
    <div class="stat-card-value">
      KES <%= number_with_delimiter(@financial_overview[:total_revenue].to_i) %>
    </div>
    <div class="stat-card-label">Total Revenue</div>
    <div class="stat-card-change">
      <i class="bi bi-arrow-up"></i>
      Earned
    </div>
  </div>

  <div class="stat-card expenses">
    <div class="stat-card-icon"><i class="bi bi-wallet"></i></div>
    <div class="stat-card-value">
      KES <%= number_with_delimiter(@financial_overview[:total_expenses].to_i) %>
    </div>
    <div class="stat-card-label">Total Expenses</div>
    <div class="stat-card-change">
      <i class="bi bi-arrow-down"></i>
      Spent
    </div>
  </div>

  <div class="stat-card profit">
    <div class="stat-card-icon"><i class="bi bi-graph-up-arrow"></i></div>
    <div class="stat-card-value">
      KES <%= number_with_delimiter(@financial_overview[:net_profit].to_i) %>
    </div>
    <div class="stat-card-label">Net Profit</div>
    <div class="stat-card-change">
      <i class="bi bi-percent"></i>
      <%= @financial_overview[:profit_margin] %>%
    </div>
  </div>

  <div class="stat-card production">
    <div class="stat-card-icon"><i class="bi bi-droplet"></i></div>
    <div class="stat-card-value">
      <%= number_with_precision(@quick_stats[:production_volume], precision: 1) %>L
    </div>
    <div class="stat-card-label">Milk Produced</div>
    <div class="stat-card-change">
      <i class="bi bi-emoji-smile"></i>
      <%= @quick_stats[:active_cows] %> cows
    </div>
  </div>
</div>

<!-- Period Selector -->
<div class="period-selector">
  <small style="color: #718096; margin-right: auto;">Select Period:</small>
  <a href="<%= financial_reports_path(period: 'week') %>" class="period-btn <%= 'active' if params[:period] == 'week' %>">
    <i class="bi bi-calendar-week me-1"></i>Week
  </a>
  <a href="<%= financial_reports_path(period: 'month') %>" class="period-btn <%= 'active' if params[:period] == 'month' || params[:period].blank? %>">
    <i class="bi bi-calendar-month me-1"></i>Month
  </a>
  <a href="<%= financial_reports_path(period: 'quarter') %>" class="period-btn <%= 'active' if params[:period] == 'quarter' %>">
    <i class="bi bi-calendar3 me-1"></i>Quarter
  </a>
  <a href="<%= financial_reports_path(period: 'year') %>" class="period-btn <%= 'active' if params[:period] == 'year' %>">
    <i class="bi bi-calendar-year me-1"></i>Year
  </a>
</div>

<!-- Charts Section -->
<div class="charts-container">
  <div class="chart-card">
    <div class="chart-title">
      <i class="bi bi-graph-up"></i>
      Financial Trend (6 Months)
    </div>
    <canvas id="financialTrendChart" height="250"></canvas>
  </div>

  <div class="chart-card">
    <div class="chart-title">
      <i class="bi bi-pie-chart"></i>
      Profit Breakdown
    </div>
    <canvas id="profitBreakdownChart" height="250"></canvas>
    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
        <span style="color: #718096;">Revenue:</span>
        <strong style="color: #1a202c;">KES <%= number_with_delimiter(@financial_overview[:total_revenue].to_i) %></strong>
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
        <span style="color: #718096;">Expenses:</span>
        <strong style="color: #1a202c;">KES <%= number_with_delimiter(@financial_overview[:total_expenses].to_i) %></strong>
      </div>
      <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid #e2e8f0;">
        <span style="color: #718096;">Margin:</span>
        <strong style="color: #10b981; font-size: 1.1rem;"><%= @financial_overview[:profit_margin] %>%</strong>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="actions-container">
  <%= link_to profit_loss_financial_reports_path, class: "action-card success" do %>
    <i class="bi bi-file-earmark-bar-graph action-icon"></i>
    <div class="action-title">Profit & Loss</div>
    <div class="action-description">Detailed P&L analysis</div>
  <% end %>

  <%= link_to cost_analysis_financial_reports_path, class: "action-card warning" do %>
    <i class="bi bi-pie-chart-fill action-icon"></i>
    <div class="action-title">Cost Analysis</div>
    <div class="action-description">Break down your costs</div>
  <% end %>

  <%= link_to roi_report_financial_reports_path, class: "action-card info" do %>
    <i class="bi bi-graph-up-arrow action-icon"></i>
    <div class="action-title">ROI Analytics</div>
    <div class="action-description">Return on investment</div>
  <% end %>

  <a href="#" class="action-card primary" onclick="downloadReport()">
    <i class="bi bi-download action-icon"></i>
    <div class="action-title">Export Report</div>
    <div class="action-description">Download as PDF</div>
  </a>
</div>

<!-- KPI Section -->
<div class="kpi-container">
  <div class="kpi-card">
    <div class="kpi-title">
      <i class="bi bi-speedometer2"></i>
      Key Performance Indicators
    </div>

    <div class="progress-item <%= @financial_overview[:profit_margin] >= 15 ? 'success' : @financial_overview[:profit_margin] >= 5 ? 'warning' : 'danger' %>">
      <div class="progress-label">
        <span>Profit Margin</span>
        <span><strong><%= @financial_overview[:profit_margin] %>%</strong></span>
      </div>
      <div class="progress">
        <div class="progress-bar" style="width: <%= [@financial_overview[:profit_margin], 100].min.abs %>%"></div>
      </div>
    </div>

    <div class="progress-item success">
      <div class="progress-label">
        <span>Revenue Target</span>
        <span><strong><%= number_with_precision(rand(65..95), precision: 0) %>%</strong></span>
      </div>
      <div class="progress">
        <div class="progress-bar" style="width: <%= rand(65..95) %>%"></div>
      </div>
    </div>

    <div class="progress-item warning">
      <div class="progress-label">
        <span>Cost Control</span>
        <span><strong><%= number_with_precision(rand(55..80), precision: 0) %>%</strong></span>
      </div>
      <div class="progress">
        <div class="progress-bar" style="width: <%= rand(55..80) %>%"></div>
      </div>
    </div>
  </div>

  <div class="kpi-card">
    <div class="kpi-title">
      <i class="bi bi-boxes"></i>
      Investment Summary
    </div>

    <div style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; color: white; margin-bottom: 15px;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
        <span>Total Investment</span>
        <strong style="font-size: 1.5rem;">KES <%= number_with_delimiter(rand(500000..2000000), precision: 0) %></strong>
      </div>
      <div style="display: flex; justify-content: space-between; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px;">
        <span>Annual ROI</span>
        <strong><%= rand(15..45) %>%</strong>
      </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
      <div style="background: #f0f4f8; padding: 15px; border-radius: 10px;">
        <small style="color: #718096;">Equipment</small>
        <div style="font-weight: 700; color: #1a202c; margin-top: 5px;">
          KES <%= number_with_delimiter(rand(200000..800000), precision: 0) %>
        </div>
      </div>
      <div style="background: #f0f4f8; padding: 15px; border-radius: 10px;">
        <small style="color: #718096;">Breeding</small>
        <div style="font-weight: 700; color: #1a202c; margin-top: 5px;">
          KES <%= number_with_delimiter(rand(100000..500000), precision: 0) %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Charts Scripts -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Financial Trend Chart
    const ctx1 = document.getElementById('financialTrendChart')?.getContext('2d');
    if (ctx1) {
      new Chart(ctx1, {
        type: 'line',
        data: {
          labels: <%= @monthly_trend.keys.to_json %>,
          datasets: [
            {
              label: 'Revenue',
              data: <%= @monthly_trend.values.map { |v| v[:revenue] }.to_json %>,
              borderColor: '#10b981',
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
              tension: 0.4,
              fill: true,
              borderWidth: 3
            },
            {
              label: 'Expenses',
              data: <%= @monthly_trend.values.map { |v| v[:expenses] }.to_json %>,
              borderColor: '#f59e0b',
              backgroundColor: 'rgba(245, 158, 11, 0.1)',
              tension: 0.4,
              fill: true,
              borderWidth: 3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'KES ' + value.toLocaleString();
                }
              }
            }
          }
        }
      });
    }

    // Profit Breakdown Chart
    const ctx2 = document.getElementById('profitBreakdownChart')?.getContext('2d');
    if (ctx2) {
      new Chart(ctx2, {
        type: 'doughnut',
        data: {
          labels: ['Revenue', 'Expenses'],
          datasets: [{
            data: [<%= @financial_overview[:total_revenue] %>, <%= @financial_overview[:total_expenses] %>],
            backgroundColor: [
              'rgba(16, 185, 129, 0.8)',
              'rgba(245, 158, 11, 0.8)'
            ],
            borderColor: [
              '#10b981',
              '#f59e0b'
            ],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20
              }
            }
          }
        }
      });
    }
  });

  function downloadReport() {
    alert('Report export functionality coming soon!');
  }
</script>
          </div>

          <div class="progress-item mb-3">
            <div class="d-flex justify-content-between mb-1">
              <span>Sales Efficiency</span>
              <span><%= ((@quick_stats[:sales_volume] / @quick_stats[:production_volume]) * 100).round(1) rescue 0 %>%</span>
            </div>
            <div class="progress">
              <div class="progress-bar bg-info" 
                   style="width: <%= [((@quick_stats[:sales_volume] / @quick_stats[:production_volume]) * 100).round(1), 100].min rescue 0 %>%"></div>
            </div>
          </div>

          <div class="progress-item mb-3">
            <div class="d-flex justify-content-between mb-1">
              <span>Daily Production Target</span>
              <span><%= @quick_stats[:avg_daily_production].round(1) %>L</span>
            </div>
            <div class="progress">
              <div class="progress-bar bg-primary" 
                   style="width: <%= [(@quick_stats[:avg_daily_production] / (@quick_stats[:active_cows] * 20)) * 100, 100].min %>%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="bi bi-exclamation-triangle"></i>
            Financial Alerts
          </h5>
        </div>
        <div class="card-body">
          <% if @financial_overview[:profit_margin] < 5 %>
            <div class="alert alert-warning">
              <i class="bi bi-exclamation-triangle"></i>
              Low profit margin detected (<%= @financial_overview[:profit_margin] %>%). Consider cost optimization.
            </div>
          <% end %>

          <% if @financial_overview[:net_profit] < 0 %>
            <div class="alert alert-danger">
              <i class="bi bi-exclamation-octagon"></i>
              Operating at a loss. Immediate action required to reduce expenses or increase revenue.
            </div>
          <% end %>

          <% if @quick_stats[:avg_daily_production] < (@quick_stats[:active_cows] * 15) %>
            <div class="alert alert-info">
              <i class="bi bi-info-circle"></i>
              Production below expected levels. Consider reviewing animal health and nutrition.
            </div>
          <% end %>

          <% unless @financial_overview[:profit_margin] < 5 || @financial_overview[:net_profit] < 0 || @quick_stats[:avg_daily_production] < (@quick_stats[:active_cows] * 15) %>
            <div class="alert alert-success">
              <i class="bi bi-check-circle"></i>
              All financial indicators are healthy. Continue current operations.
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Charts JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Financial Trend Chart
const trendData = <%= @monthly_trend.to_json.html_safe %>;
const trendLabels = Object.keys(trendData).reverse();
const revenueData = trendLabels.map(label => trendData[label].revenue);
const expenseData = trendLabels.map(label => trendData[label].expenses);
const profitData = trendLabels.map(label => trendData[label].profit);

const ctx1 = document.getElementById('financialTrendChart').getContext('2d');
new Chart(ctx1, {
  type: 'line',
  data: {
    labels: trendLabels,
    datasets: [
      {
        label: 'Revenue',
        data: revenueData,
        borderColor: 'rgb(40, 167, 69)',
        backgroundColor: 'rgba(40, 167, 69, 0.1)',
        tension: 0.4,
        fill: false
      },
      {
        label: 'Expenses',
        data: expenseData,
        borderColor: 'rgb(255, 193, 7)',
        backgroundColor: 'rgba(255, 193, 7, 0.1)',
        tension: 0.4,
        fill: false
      },
      {
        label: 'Profit',
        data: profitData,
        borderColor: 'rgb(0, 123, 255)',
        backgroundColor: 'rgba(0, 123, 255, 0.1)',
        tension: 0.4,
        fill: true
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'top'
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          callback: function(value) {
            return 'KES ' + value.toLocaleString();
          }
        }
      }
    }
  }
});

// Profit Breakdown Doughnut Chart
const ctx2 = document.getElementById('profitBreakdownChart').getContext('2d');
new Chart(ctx2, {
  type: 'doughnut',
  data: {
    labels: ['Revenue', 'Expenses'],
    datasets: [{
      data: [<%= @financial_overview[:total_revenue] %>, <%= @financial_overview[:total_expenses] %>],
      backgroundColor: ['#28a745', '#ffc107'],
      borderWidth: 0
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom'
      }
    }
  }
});

// Export functionality
function downloadReport() {
  // This would be implemented to generate PDF or Excel reports
  alert('Export functionality would be implemented here');
}

// Mobile optimization
if (window.innerWidth < 768) {
  // Optimize charts for mobile
  Chart.defaults.font.size = 10;
  Chart.defaults.plugins.legend.labels.padding = 10;
}
</script>

<style>
.financial-dashboard .stat-card {
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  transition: transform 0.2s;
}

.financial-dashboard .stat-card:hover {
  transform: translateY(-2px);
}

.stat-icon {
  float: right;
  font-size: 2.5rem;
  opacity: 0.8;
}

.stat-content h3 {
  margin: 0;
  font-size: 1.8rem;
  font-weight: bold;
}

.progress-item .progress {
  height: 8px;
  border-radius: 4px;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
  .financial-dashboard .stat-card {
    padding: 15px;
    margin-bottom: 15px;
  }
  
  .stat-content h3 {
    font-size: 1.4rem;
  }
  
  .stat-icon {
    font-size: 2rem;
  }
  
  .header-actions .btn-group {
    flex-wrap: wrap;
  }
  
  .header-actions .btn-group .btn {
    font-size: 0.875rem;
    padding: 0.375rem 0.75rem;
  }
  
  canvas {
    max-height: 250px !important;
  }
}

@media (max-width: 576px) {
  .page-header {
    text-align: center;
  }
  
  .header-actions {
    margin-top: 15px;
    width: 100%;
  }
  
  .header-actions .btn-group {
    width: 100%;
  }
  
  .header-actions .btn {
    flex: 1;
  }
}
</style>
