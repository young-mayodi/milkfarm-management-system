<% content_for :title, "Animal Sale Details" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1>
      <i class="bi bi-receipt me-2"></i>Sale Details
      <% if @farm %>
        <span class="badge bg-primary"><%= @farm.name %></span>
      <% end %>
    </h1>
    <p class="text-muted">Sale record for <%= @animal_sale.cow.name %></p>
  </div>
  <div class="btn-group">
    <%= link_to "Edit Sale", 
          (@farm ? edit_farm_animal_sale_path(@farm, @animal_sale) : edit_animal_sale_path(@animal_sale)), 
          class: "btn btn-outline-primary" %>
    <%= link_to "Back to Sales", 
          (@farm ? farm_animal_sales_path(@farm) : animal_sales_path), 
          class: "btn btn-outline-secondary" %>
  </div>
</div>

<div class="row">
  <div class="col-md-8">
    <!-- Sale Information Card -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Sale Information</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-muted">Sale Date</h6>
            <p class="mb-3">
              <span class="badge bg-primary fs-6">
                <%= @animal_sale.sale_date.strftime("%B %d, %Y") %>
              </span>
            </p>

            <h6 class="text-muted">Sale Price</h6>
            <p class="mb-3">
              <span class="h4 text-success">$<%= number_with_delimiter(@animal_sale.sale_price) %></span>
            </p>

            <h6 class="text-muted">Animal Type</h6>
            <p class="mb-3">
              <span class="badge 
                <%= case @animal_sale.animal_type
                    when 'cow' then 'bg-primary'
                    when 'calf' then 'bg-success' 
                    when 'bull' then 'bg-warning text-dark'
                    else 'bg-secondary'
                    end %> fs-6">
                <%= @animal_sale.animal_type.titleize %>
              </span>
            </p>
          </div>
          <div class="col-md-6">
            <h6 class="text-muted">Buyer</h6>
            <p class="mb-3">
              <strong><%= @animal_sale.buyer %></strong>
              <% if @animal_sale.buyer_contact.present? %>
                <br><small class="text-muted"><%= @animal_sale.buyer_contact %></small>
              <% end %>
            </p>

            <% if @animal_sale.weight_at_sale.present? %>
              <h6 class="text-muted">Weight at Sale</h6>
              <p class="mb-3"><%= @animal_sale.weight_at_sale %> lbs</p>
            <% end %>

            <h6 class="text-muted">Farm</h6>
            <p class="mb-3"><%= @animal_sale.farm.name %></p>
          </div>
        </div>

        <% if @animal_sale.notes.present? %>
          <hr>
          <h6 class="text-muted">Notes</h6>
          <p class="mb-0"><%= simple_format(@animal_sale.notes) %></p>
        <% end %>
      </div>
    </div>

    <!-- Animal Information Card -->
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Animal Information</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-muted">Name</h6>
            <p class="mb-3"><strong><%= @animal_sale.cow.name %></strong></p>

            <h6 class="text-muted">Tag Number</h6>
            <p class="mb-3">
              <span class="badge bg-secondary">#<%= @animal_sale.cow.tag_number %></span>
            </p>

            <h6 class="text-muted">Breed</h6>
            <p class="mb-3"><%= @animal_sale.cow.breed %></p>
          </div>
          <div class="col-md-6">
            <h6 class="text-muted">Age at Sale</h6>
            <p class="mb-3"><%= @animal_sale.cow.age %> years old</p>

            <h6 class="text-muted">Current Status</h6>
            <p class="mb-3">
              <span class="badge bg-warning">
                <%= @animal_sale.cow.status.humanize %>
              </span>
            </p>

            <% if @animal_sale.cow.mother.present? %>
              <h6 class="text-muted">Mother</h6>
              <p class="mb-3">
                <%= link_to @animal_sale.cow.mother.name, 
                      (@farm ? farm_cow_path(@farm, @animal_sale.cow.mother) : cow_path(@animal_sale.cow.mother)),
                      class: "text-decoration-none" %>
                <small class="text-muted">(#<%= @animal_sale.cow.mother.tag_number %>)</small>
              </p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <!-- Quick Stats Card -->
    <div class="card mb-4">
      <div class="card-header">
        <h6 class="mb-0">Sale Summary</h6>
      </div>
      <div class="card-body text-center">
        <div class="mb-3">
          <div class="h2 text-success mb-1">$<%= number_with_delimiter(@animal_sale.sale_price) %></div>
          <small class="text-muted">Sale Price</small>
        </div>
        
        <% if @animal_sale.weight_at_sale.present? %>
          <div class="mb-3">
            <div class="h4 mb-1"><%= @animal_sale.weight_at_sale %> lbs</div>
            <small class="text-muted">Weight at Sale</small>
          </div>
          
          <div class="mb-3">
            <div class="h5 mb-1">
              $<%= number_with_delimiter((@animal_sale.sale_price / @animal_sale.weight_at_sale).round(2)) %>
            </div>
            <small class="text-muted">Price per lb</small>
          </div>
        <% end %>

        <hr>
        
        <div class="text-start">
          <small class="text-muted">
            <i class="bi bi-calendar-event me-1"></i>
            Sold on <%= @animal_sale.sale_date.strftime("%m/%d/%Y") %>
          </small>
          <br>
          <small class="text-muted">
            <i class="bi bi-person me-1"></i>
            Buyer: <%= @animal_sale.buyer %>
          </small>
        </div>
      </div>
    </div>

    <!-- Actions Card -->
    <div class="card">
      <div class="card-header">
        <h6 class="mb-0">Actions</h6>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <%= link_to "Edit Sale Record", 
                (@farm ? edit_farm_animal_sale_path(@farm, @animal_sale) : edit_animal_sale_path(@animal_sale)), 
                class: "btn btn-outline-primary" %>
          
          <%= link_to "View Animal Profile", 
                (@farm ? farm_cow_path(@farm, @animal_sale.cow) : cow_path(@animal_sale.cow)), 
                class: "btn btn-outline-info" %>
          
          <hr class="my-2">
          
          <%= link_to "Delete Sale Record", 
                (@farm ? farm_animal_sale_path(@farm, @animal_sale) : animal_sale_path(@animal_sale)), 
                method: :delete,
                data: { 
                  confirm: "Are you sure you want to delete this sale record? This will revert the animal's status back to active." 
                },
                class: "btn btn-outline-danger" %>
        </div>
      </div>
    </div>
  </div>
</div>
