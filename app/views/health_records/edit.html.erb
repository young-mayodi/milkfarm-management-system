<div class="health-records-container">
  <div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2 class="page-title">
          <i class="bi bi-pencil-square"></i>
          Edit Health Record for <%= @health_record.cow.tag_number %>
        </h2>
        <p class="text-muted">Update animal health status and observations</p>
      </div>
      <div class="header-actions">
        <%= link_to @health_record, class: "btn btn-outline-secondary" do %>
          <i class="bi bi-arrow-left"></i>
          Back to Record
        <% end %>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-body">
          <%= form_with model: @health_record, local: true, class: "health-form" do |form| %>
            <% if @health_record.errors.any? %>
              <div class="alert alert-danger">
                <h6>Please fix the following errors:</h6>
                <ul class="mb-0">
                  <% @health_record.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <!-- Hidden field to maintain cow association -->
            <%= form.hidden_field :cow_id %>

            <div class="row">
              <!-- Animal Info (Read-only) -->
              <div class="col-md-6 mb-3">
                <label class="form-label">Animal</label>
                <div class="form-control-plaintext">
                  <strong><%= @health_record.cow.display_name %></strong>
                  <small class="text-muted d-block">
                    <%= @health_record.cow.breed %> • <%= @health_record.cow.age %> years old
                  </small>
                </div>
              </div>

              <!-- Health Status -->
              <div class="col-md-6 mb-3">
                <%= form.label :health_status, "Health Status", class: "form-label required" %>
                <%= form.select :health_status,
                    options_for_select([
                      ['Healthy', 'healthy'],
                      ['Sick', 'sick'],
                      ['Recovering', 'recovering'],
                      ['In Heat', 'in_heat'],
                      ['Injured', 'injured'],
                      ['Quarantine', 'quarantine'],
                      ['Critical', 'critical']
                    ], @health_record.health_status),
                    { prompt: "Select health status..." },
                    { class: "form-select", required: true } %>
              </div>
            </div>

            <div class="row">
              <!-- Temperature -->
              <div class="col-md-6 mb-3">
                <%= form.label :temperature, "Temperature (°C)", class: "form-label" %>
                <%= form.number_field :temperature, 
                    class: "form-control",
                    step: 0.1,
                    min: 35.0,
                    max: 45.0,
                    placeholder: "38.5" %>
                <small class="form-text text-muted">
                  Normal range: 38.0 - 39.5°C
                </small>
              </div>

              <!-- Weight -->
              <div class="col-md-6 mb-3">
                <%= form.label :weight, "Weight (kg)", class: "form-label" %>
                <%= form.number_field :weight, 
                    class: "form-control",
                    step: 1,
                    min: 0,
                    placeholder: "450" %>
                <small class="form-text text-muted">
                  Current weight in kilograms
                </small>
              </div>
            </div>

            <div class="row">
              <!-- Recorded By -->
              <div class="col-md-6 mb-3">
                <%= form.label :recorded_by, "Recorded By", class: "form-label" %>
                <%= form.text_field :recorded_by, 
                    class: "form-control",
                    placeholder: "Your name" %>
              </div>

              <!-- Veterinarian -->
              <div class="col-md-6 mb-3">
                <%= form.label :veterinarian, "Veterinarian", class: "form-label" %>
                <%= form.text_field :veterinarian, 
                    class: "form-control",
                    placeholder: "Dr. Smith (optional)" %>
              </div>
            </div>

            <!-- Additional Notes -->
            <div class="mb-3">
              <%= form.label :notes, "Health Notes", class: "form-label" %>
              <%= form.text_area :notes, 
                  class: "form-control",
                  rows: 4,
                  placeholder: "Record symptoms, observations, treatments, or any additional notes..." %>
            </div>

            <!-- Submit Actions -->
            <div class="form-actions">
              <%= form.submit "Update Health Record", 
                  class: "btn btn-primary btn-lg",
                  data: { disable_with: "Updating..." } %>
              
              <%= link_to @health_record, 
                  class: "btn btn-outline-secondary btn-lg ms-2" do %>
                Cancel
              <% end %>
              
              <%= link_to @health_record, 
                  method: :delete,
                  class: "btn btn-outline-danger btn-lg ms-2",
                  confirm: "Are you sure you want to delete this health record?" do %>
                <i class="bi bi-trash"></i>
                Delete
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Sidebar with Health Guidelines -->
    <div class="col-lg-4">
      <div class="card bg-light">
        <div class="card-header">
          <h6 class="card-title mb-0">
            <i class="bi bi-info-circle"></i>
            Health Monitoring Guidelines
          </h6>
        </div>
        <div class="card-body">
          <h6 class="text-success">Normal Vital Signs:</h6>
          <ul class="list-unstyled small">
            <li><strong>Temperature:</strong> 38.0 - 39.5°C</li>
            <li><strong>Heart Rate:</strong> 60-80 BPM</li>
            <li><strong>Respiratory Rate:</strong> 15-30/min</li>
          </ul>

          <hr>

          <h6 class="text-warning">Warning Signs:</h6>
          <ul class="list-unstyled small">
            <li>• Temperature > 39.5°C (fever)</li>
            <li>• Temperature < 38.0°C (hypothermia)</li>
            <li>• Loss of appetite</li>
            <li>• Lethargy or depression</li>
            <li>• Abnormal discharge</li>
            <li>• Difficulty breathing</li>
            <li>• Lameness or limping</li>
          </ul>

          <hr>

          <div class="record-info">
            <h6 class="text-info">Record Information:</h6>
            <small class="text-muted">
              <strong>Created:</strong> <%= @health_record.created_at.strftime("%B %d, %Y") %><br>
              <strong>Last Updated:</strong> <%= @health_record.updated_at.strftime("%B %d, %Y") %>
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.health-records-container {
  padding: 20px;
}

.page-title {
  font-family: 'Poppins', sans-serif;
  font-weight: 600;
  color: #2c3e50;
}

.health-form .form-label.required::after {
  content: " *";
  color: #dc3545;
}

.form-actions {
  border-top: 1px solid #e9ecef;
  padding-top: 20px;
  margin-top: 30px;
}

.card {
  border: none;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  border-radius: 12px;
}

.btn {
  border-radius: 8px;
  font-weight: 500;
}
</style>
