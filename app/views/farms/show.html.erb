<div class="row">
  <div class="col-md-8">
    <h1><%= @farm.name %></h1>
    <p class="lead text-muted"><%= @farm.location %></p>
  </div>
  <div class="col-md-4 text-end">
    <%= link_to "Edit Farm", edit_farm_path(@farm), class: "btn btn-primary me-2" %>
    <%= link_to "All Farms", farms_path, class: "btn btn-outline-secondary" %>
  </div>
</div>

<!-- Farm Info -->
<div class="row mb-4">
  <div class="col-md-8">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Farm Information</h5>
        <dl class="row">
          <dt class="col-sm-3">Owner:</dt>
          <dd class="col-sm-9"><%= @farm.owner %></dd>
          
          <dt class="col-sm-3">Contact:</dt>
          <dd class="col-sm-9"><%= @farm.contact_phone %></dd>
          
          <dt class="col-sm-3">Location:</dt>
          <dd class="col-sm-9"><%= @farm.location %></dd>
        </dl>
      </div>
    </div>
  </div>
  
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Monthly Summary</h5>
        <div class="row">
          <div class="col-6">
            <div class="text-center">
              <h4 class="text-primary"><%= number_with_precision(@monthly_production, precision: 1) %>L</h4>
              <small class="text-muted">Production</small>
            </div>
          </div>
          <div class="col-6">
            <div class="text-center">
              <h4 class="text-success">$<%= number_with_precision(@monthly_sales, precision: 0) %></h4>
              <small class="text-muted">Sales</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Actions Row -->
<div class="row mb-4">
  <div class="col-12">
    <div class="btn-group" role="group">
      <%= link_to farm_cows_path(@farm), class: "btn btn-outline-primary" do %>
        <i class="bi bi-list-ul me-1"></i>View Cows (<%= @farm.total_cows %>)
      <% end %>
      <%= link_to new_farm_cow_path(@farm), class: "btn btn-outline-success" do %>
        <i class="bi bi-plus me-1"></i>Add Cow
      <% end %>
      <%= link_to farm_production_records_path(@farm), class: "btn btn-outline-info" do %>
        <i class="bi bi-clipboard-data me-1"></i>Production Records
      <% end %>
      <%= link_to new_farm_production_record_path(@farm), class: "btn btn-outline-warning" do %>
        <i class="bi bi-plus me-1"></i>Record Production
      <% end %>
    </div>
  </div>
</div>

<div class="row">
  <!-- Cows List -->
  <div class="col-md-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between">
        <h5 class="mb-0">Cows</h5>
        <%= link_to "View All", farm_cows_path(@farm), class: "btn btn-sm btn-primary" %>
      </div>
      <div class="card-body">
        <% if @cows.any? %>
          <% @cows.limit(10).each do |cow| %>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <strong><%= cow.name %></strong>
                <small class="text-muted">(<%= cow.tag_number %>)</small>
                <div class="small">
                  <%= cow.breed %> â€¢ <%= cow.age %> years
                  <span class="badge bg-<%= cow.status == 'active' ? 'success' : 'secondary' %> ms-1">
                    <%= cow.status.humanize %>
                  </span>
                </div>
              </div>
            </div>
          <% end %>
          <% if @cows.count > 10 %>
            <div class="text-center mt-3">
              <%= link_to "View all #{@cows.count} cows", farm_cows_path(@farm), class: "btn btn-sm btn-outline-primary" %>
            </div>
          <% end %>
        <% else %>
          <p class="text-muted">No cows registered yet.</p>
          <%= link_to "Add first cow", new_farm_cow_path(@farm), class: "btn btn-sm btn-primary" %>
        <% end %>
      </div>
    </div>
  </div>
  
  <!-- Recent Production -->
  <div class="col-md-6">
    <div class="card">
      <div class="card-header d-flex justify-content-between">
        <h5 class="mb-0">Recent Production</h5>
        <%= link_to "View All", farm_production_records_path(@farm), class: "btn btn-sm btn-primary" %>
      </div>
      <div class="card-body">
        <% if @recent_production.any? %>
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Cow</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <% @recent_production.each do |record| %>
                  <tr>
                    <td><%= record.production_date.strftime("%m/%d") %></td>
                    <td><%= record.cow.name %></td>
                    <td>
                      <span class="badge bg-light text-dark">
                        <%= number_with_precision(record.total_production, precision: 1) %>L
                      </span>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <p class="text-muted">No production records yet.</p>
          <%= link_to "Add first record", new_farm_production_record_path(@farm), class: "btn btn-sm btn-primary" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Production Charts Section -->
<div class="row mb-4">
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Daily Production Trend (30 days)</h5>
      </div>
      <div class="card-body" style="height: 300px;">
        <canvas data-controller="chart" 
                data-chart-type-value="line"
                data-chart-data-value="<%= chart_data_json(@production_chart_data) %>"
                data-chart-options-value="<%= chart_options_json({plugins: {legend: {display: false}}}) %>">
        </canvas>
      </div>
    </div>
  </div>
  
  <div class="col-lg-6">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Top Producing Cows (30 days)</h5>
      </div>
      <div class="card-body" style="height: 300px;">
        <canvas data-controller="chart" 
                data-chart-type-value="bar"
                data-chart-data-value="<%= chart_data_json(@cow_chart_data) %>"
                data-chart-options-value="<%= chart_options_json({plugins: {legend: {display: false}}}) %>">
        </canvas>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Quick Actions</h5>
        <div class="row">
          <div class="col-md-3">
            <%= link_to "Add Cow", new_farm_cow_path(@farm), class: "btn btn-success w-100" %>
          </div>
          <div class="col-md-3">
            <%= link_to "Production Records", farm_production_records_path(@farm), class: "btn btn-info w-100" %>
          </div>
          <div class="col-md-3">
            <%= link_to "Sales Records", farm_sales_records_path(@farm), class: "btn btn-warning w-100" %>
          </div>
          <div class="col-md-3">
            <%= link_to "Production Trends", production_trends_reports_path(farm_id: @farm.id), class: "btn btn-primary w-100" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
