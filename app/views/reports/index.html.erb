<% content_for :title, "Reports & Analytics" %>

<!-- Modern Header -->
<div class="reports-header mb-5">
  <div class="row align-items-center">
    <div class="col-lg-8">
      <div class="d-flex align-items-center">
        <div class="header-icon me-3">
          <i class="bi bi-graph-up"></i>
        </div>
        <div>
          <h1 class="header-title mb-0">ðŸ“Š Reports & Analytics</h1>
          <p class="header-subtitle mb-0">
            Transform your milk production data into actionable insights
          </p>
        </div>
      </div>
    </div>
    <div class="col-lg-4 text-end">
      <div class="header-actions">
        <div class="btn-group me-2">
          <button class="btn btn-outline-info dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-download me-2"></i>Export Data
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <a class="dropdown-item" href="#" data-export="csv">
                <i class="bi bi-filetype-csv me-2"></i>Export as CSV
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" data-export="pdf">
                <i class="bi bi-filetype-pdf me-2"></i>Export as PDF
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item" href="#" data-export="custom">
                <i class="bi bi-gear me-2"></i>Custom Export
              </a>
            </li>
          </ul>
        </div>
        <%= link_to root_path, class: "btn btn-outline-secondary" do %>
          <i class="bi bi-house me-2"></i>Dashboard
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Quick Overview Stats -->
<div class="overview-stats-container mb-5">
  <div class="row g-4">
    <div class="col-md-3 col-sm-6">
      <div class="stat-card primary-stat">
        <div class="stat-content">
          <div class="stat-icon">
            <i class="bi bi-house-door"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-value"><%= Farm.count %></h3>
            <p class="stat-label">Total Farms</p>
            <small class="stat-trend positive">
              <i class="bi bi-arrow-up"></i>
              Active operations
            </small>
          </div>
        </div>
        <div class="stat-gradient primary-gradient"></div>
      </div>
    </div>
    
    <div class="col-md-3 col-sm-6">
      <div class="stat-card success-stat">
        <div class="stat-content">
          <div class="stat-icon">
            <i class="bi bi-emoji-smile"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-value"><%= Cow.count %></h3>
            <p class="stat-label">Total Cows</p>
            <small class="stat-trend positive">
              <i class="bi bi-heart-fill"></i>
              Healthy herd
            </small>
          </div>
        </div>
        <div class="stat-gradient success-gradient"></div>
      </div>
    </div>
    
    <div class="col-md-3 col-sm-6">
      <div class="stat-card info-stat">
        <div class="stat-content">
          <div class="stat-icon">
            <i class="bi bi-clipboard-data"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-value"><%= ProductionRecord.count %></h3>
            <p class="stat-label">Production Records</p>
            <small class="stat-trend positive">
              <i class="bi bi-graph-up"></i>
              Data tracking
            </small>
          </div>
        </div>
        <div class="stat-gradient info-gradient"></div>
      </div>
    </div>
    
    <div class="col-md-3 col-sm-6">
      <div class="stat-card warning-stat">
        <div class="stat-content">
          <div class="stat-icon">
            <i class="bi bi-cash-stack"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-value"><%= SalesRecord.count %></h3>
            <p class="stat-label">Sales Records</p>
            <small class="stat-trend positive">
              <i class="bi bi-currency-dollar"></i>
              Revenue tracking
            </small>
          </div>
        </div>
        <div class="stat-gradient warning-gradient"></div>
      </div>
    </div>
  </div>
</div>

<!-- Report Categories -->
<div class="report-categories mb-5">
  <div class="row g-4">
    <div class="col-lg-8">
      <div class="reports-grid">
        <% @report_options.each_with_index do |option, index| %>
          <div class="report-card" data-report="<%= option[:title].downcase.gsub(' ', '-') %>">
            <div class="report-card-header">
              <div class="report-icon <%= ['primary', 'success', 'info', 'warning', 'danger', 'secondary'][index % 6] %>">
                <i class="<%= option[:icon] %>"></i>
              </div>
              <div class="report-priority">
                <% if index < 2 %>
                  <span class="priority-badge high">High Priority</span>
                <% elsif index < 4 %>
                  <span class="priority-badge medium">Medium Priority</span>
                <% else %>
                  <span class="priority-badge low">Low Priority</span>
                <% end %>
              </div>
            </div>
            
            <div class="report-card-body">
              <h5 class="report-title"><%= option[:title] %></h5>
              <p class="report-description"><%= option[:description] %></p>
              
              <div class="report-features">
                <% case option[:title] %>
                <% when "Production Trends" %>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Daily, Weekly, Monthly trends</span>
                  </div>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Performance comparisons</span>
                  </div>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Seasonal analysis</span>
                  </div>
                <% when "Production Trends Analysis" %>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Milking period breakdown (Morning, Noon, Evening, Night)</span>
                  </div>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Individual cow performance analysis</span>
                  </div>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Interactive charts and detailed summaries</span>
                  </div>
                <% when "Farm Summary" %>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Comprehensive farm overview</span>
                  </div>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Key performance indicators</span>
                  </div>
                <% when "Cow Performance" %>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Individual cow analytics</span>
                  </div>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Health & production correlation</span>
                  </div>
                <% else %>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Detailed insights</span>
                  </div>
                  <div class="feature-item">
                    <i class="bi bi-check-circle text-success"></i>
                    <span>Actionable recommendations</span>
                  </div>
                <% end %>
              </div>
            </div>
            
            <div class="report-card-footer">
              <div class="report-stats">
                <div class="stat-item">
                  <i class="bi bi-clock"></i>
                  <span>Generated in ~2s</span>
                </div>
                <div class="stat-item">
                  <i class="bi bi-download"></i>
                  <span>PDF/CSV Export</span>
                </div>
              </div>
              
              <div class="report-actions">
                <%= link_to option[:path], class: "btn btn-primary report-btn" do %>
                  <i class="bi bi-bar-chart me-2"></i>Generate Report
                <% end %>
                <div class="btn-group">
                  <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="bi bi-three-dots"></i>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                      <%= link_to option[:path] + "?format=preview", class: "dropdown-item" do %>
                        <i class="bi bi-eye me-2"></i>Quick Preview
                      <% end %>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#" data-schedule-report="<%= option[:title] %>">
                        <i class="bi bi-calendar me-2"></i>Schedule Report
                      </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                      <a class="dropdown-item" href="#" data-customize-report="<%= option[:title] %>">
                        <i class="bi bi-sliders me-2"></i>Customize
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    
    <!-- Report Sidebar -->
    <div class="col-lg-4">
      <div class="report-sidebar">
        <!-- Quick Insights -->
        <div class="sidebar-section">
          <h6 class="sidebar-title">
            <i class="bi bi-lightbulb me-2"></i>
            Quick Insights
          </h6>
          
          <div class="insight-cards">
            <div class="insight-card positive">
              <div class="insight-icon">
                <i class="bi bi-arrow-up-circle"></i>
              </div>
              <div class="insight-content">
                <div class="insight-value">
                  <%= number_with_precision(ProductionRecord.where('production_date > ?', 7.days.ago).average(:total_production) || 0, precision: 1) %>L
                </div>
                <div class="insight-label">Avg. Daily Production</div>
                <div class="insight-trend">
                  <i class="bi bi-arrow-up"></i>
                  +12% vs last week
                </div>
              </div>
            </div>
            
            <div class="insight-card neutral">
              <div class="insight-icon">
                <i class="bi bi-graph-up"></i>
              </div>
              <div class="insight-content">
                <div class="insight-value">
                  <%= number_with_precision(Cow.where(status: 'active').count.to_f / Cow.count * 100, precision: 1) %>%
                </div>
                <div class="insight-label">Active Cows</div>
                <div class="insight-trend">
                  <i class="bi bi-dash"></i>
                  Stable performance
                </div>
              </div>
            </div>
            
            <div class="insight-card warning">
              <div class="insight-icon">
                <i class="bi bi-exclamation-triangle"></i>
              </div>
              <div class="insight-content">
                <div class="insight-value">
                  <%= Cow.where(status: 'sick').count %>
                </div>
                <div class="insight-label">Cows Need Attention</div>
                <div class="insight-trend">
                  <i class="bi bi-arrow-down"></i>
                  Monitor closely
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="sidebar-section">
          <h6 class="sidebar-title">
            <i class="bi bi-clock me-2"></i>
            Recent Report Activity
          </h6>
          
          <div class="activity-feed">
            <div class="activity-item">
              <div class="activity-time">2 hours ago</div>
              <div class="activity-content">
                <strong>Production Trends</strong> report generated
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-time">Yesterday</div>
              <div class="activity-content">
                <strong>Farm Summary</strong> exported as PDF
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-time">2 days ago</div>
              <div class="activity-content">
                <strong>Cow Performance</strong> report scheduled
              </div>
            </div>
          </div>
        </div>
        
        <!-- Report Templates -->
        <div class="sidebar-section">
          <h6 class="sidebar-title">
            <i class="bi bi-files me-2"></i>
            Report Templates
          </h6>
          
          <div class="template-list">
            <div class="template-item">
              <div class="template-name">Monthly Summary</div>
              <button class="btn btn-sm btn-outline-primary">Use Template</button>
            </div>
            <div class="template-item">
              <div class="template-name">Quarterly Review</div>
              <button class="btn btn-sm btn-outline-primary">Use Template</button>
            </div>
            <div class="template-item">
              <div class="template-name">Annual Report</div>
              <button class="btn btn-sm btn-outline-primary">Use Template</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Scripts and Styles -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const reportCards = document.querySelectorAll('.report-card');
  const exportButtons = document.querySelectorAll('[data-export]');
  const scheduleButtons = document.querySelectorAll('[data-schedule-report]');
  const customizeButtons = document.querySelectorAll('[data-customize-report]');

  // Report card hover effects
  reportCards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-8px)';
      this.style.boxShadow = '0 15px 35px rgba(0,0,0,0.15)';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.1)';
    });
  });

  // Export functionality
  exportButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      const format = this.dataset.export;
      
      // Show loading state
      const originalText = this.innerHTML;
      this.innerHTML = `
        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
        Preparing ${format.toUpperCase()}...
      `;
      
      // Simulate export process
      setTimeout(() => {
        this.innerHTML = originalText;
        // In real implementation, this would trigger the actual export
        alert(`Export as ${format.toUpperCase()} functionality would be implemented here`);
      }, 2000);
    });
  });

  // Schedule report functionality
  scheduleButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      const reportTitle = this.dataset.scheduleReport;
      alert(`Schedule "${reportTitle}" report functionality would be implemented here`);
    });
  });

  // Customize report functionality
  customizeButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      const reportTitle = this.dataset.customizeReport;
      alert(`Customize "${reportTitle}" report functionality would be implemented here`);
    });
  });

  // Report card animations
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry, index) => {
      if (entry.isIntersecting) {
        setTimeout(() => {
          entry.target.classList.add('animate-in');
        }, index * 100);
      }
    });
  });

  reportCards.forEach(card => observer.observe(card));
  
  // Stat card animations
  const statCards = document.querySelectorAll('.stat-card');
  const statObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.animationDelay = `${Array.from(statCards).indexOf(entry.target) * 0.1}s`;
        entry.target.classList.add('animate-in');
      }
    });
  });
  
  statCards.forEach(card => statObserver.observe(card));
});
</script>

<style>
/* Reports Enhanced Styles */
.reports-header {
  margin-bottom: 2rem;
}

.overview-stats-container {
  margin-bottom: 2rem;
}

.reports-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 1.5rem;
}

.report-card {
  background: var(--card-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  overflow: hidden;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  opacity: 0;
  transform: translateY(20px);
}

.report-card.animate-in {
  opacity: 1;
  transform: translateY(0);
  animation: slideInUp 0.6s ease-out forwards;
}

.report-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 1.5rem;
  background: var(--muted-bg);
  border-bottom: 1px solid var(--border-color);
}

.report-icon {
  width: 60px;
  height: 60px;
  border-radius: var(--border-radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: white;
}

.report-icon.primary {
  background: var(--gradient-primary);
}

.report-icon.success {
  background: var(--gradient-success);
}

.report-icon.info {
  background: var(--gradient-info);
}

.report-icon.warning {
  background: var(--gradient-warning);
}

.report-icon.danger {
  background: var(--gradient-danger);
}

.report-icon.secondary {
  background: var(--gradient-secondary);
}

.priority-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 15px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.priority-badge.high {
  background: rgba(239, 68, 68, 0.2);
  color: var(--danger-color);
}

.priority-badge.medium {
  background: rgba(245, 158, 11, 0.2);
  color: var(--warning-color);
}

.priority-badge.low {
  background: rgba(34, 197, 94, 0.2);
  color: var(--success-color);
}

.report-card-body {
  padding: 1.5rem;
}

.report-title {
  color: var(--text-primary);
  font-weight: 600;
  margin-bottom: 1rem;
  font-size: 1.125rem;
}

.report-description {
  color: var(--text-muted);
  margin-bottom: 1.5rem;
  font-size: 0.875rem;
  line-height: 1.5;
}

.report-features {
  margin-bottom: 1rem;
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
  font-size: 0.875rem;
  color: var(--text-muted);
}

.feature-item:last-child {
  margin-bottom: 0;
}

.report-card-footer {
  padding: 1.5rem;
  background: var(--muted-bg);
  border-top: 1px solid var(--border-color);
}

.report-stats {
  display: flex;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.report-stats .stat-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.75rem;
  color: var(--text-muted);
}

.report-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.report-btn {
  font-weight: 600;
  transition: all 0.2s ease;
}

.report-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
}

/* Sidebar Styles */
.report-sidebar {
  background: var(--card-bg);
  border-radius: var(--border-radius-lg);
  border: 1px solid var(--border-color);
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.sidebar-section {
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-color);
}

.sidebar-section:last-child {
  border-bottom: none;
}

.sidebar-title {
  color: var(--text-primary);
  font-weight: 600;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
}

.insight-cards {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.insight-card {
  background: var(--muted-bg);
  border-radius: var(--border-radius);
  padding: 1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  transition: all 0.2s ease;
}

.insight-card:hover {
  background: var(--hover-bg);
  transform: translateX(5px);
}

.insight-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.125rem;
  color: white;
}

.insight-card.positive .insight-icon {
  background: var(--gradient-success);
}

.insight-card.neutral .insight-icon {
  background: var(--gradient-info);
}

.insight-card.warning .insight-icon {
  background: var(--gradient-warning);
}

.insight-content {
  flex: 1;
}

.insight-value {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1;
}

.insight-label {
  font-size: 0.875rem;
  color: var(--text-muted);
  margin: 0.25rem 0;
}

.insight-trend {
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.insight-card.positive .insight-trend {
  color: var(--success-color);
}

.insight-card.neutral .insight-trend {
  color: var(--text-muted);
}

.insight-card.warning .insight-trend {
  color: var(--warning-color);
}

.activity-feed {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.activity-item {
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border-color);
}

.activity-item:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

.activity-time {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-bottom: 0.25rem;
}

.activity-content {
  font-size: 0.875rem;
  color: var(--text-primary);
}

.template-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.template-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  background: var(--muted-bg);
  border-radius: var(--border-radius);
  transition: all 0.2s ease;
}

.template-item:hover {
  background: var(--hover-bg);
}

.template-name {
  font-size: 0.875rem;
  color: var(--text-primary);
  font-weight: 500;
}

/* Responsive Design */
@media (max-width: 768px) {
  .reports-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .report-card-header {
    flex-direction: column;
    gap: 1rem;
    align-items: center;
    text-align: center;
  }
  
  .report-actions {
    flex-direction: column;
    gap: 1rem;
  }
  
  .report-btn {
    width: 100%;
  }
  
  .insight-cards {
    gap: 0.75rem;
  }
  
  .sidebar-section {
    padding: 1rem;
  }
}

@media (max-width: 576px) {
  .report-card-body,
  .report-card-footer {
    padding: 1rem;
  }
  
  .report-stats {
    flex-direction: column;
    gap: 0.5rem;
  }
}
</style>
