#!/bin/bash

echo "ðŸŒŒ MilkyWay Farm Management System - Railway Deployment"
echo "======================================================="

# Run database migrations
echo "ðŸ“Š Running database migrations..."
bundle exec rails db:migrate

# Seed the database if it's empty
echo "ðŸŒ± Checking if database needs seeding..."
FARM_COUNT=$(bundle exec rails runner "puts Farm.count")

if [ "$FARM_COUNT" -eq "0" ]; then
    echo "ðŸŒ± Database is empty, running seeds..."
    bundle exec rails db:seed
    echo "âœ… Database seeded successfully!"
else
    echo "âœ… Database already contains data (${FARM_COUNT} farms)"
fi

echo "ðŸš€ Starting application..."
